<!DOCTYPE html>

<html>
<head>
<title>The Z-Machine Standards Document</title>
<link rel="stylesheet" type="text/css" href="zspec.css">
<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
</head>

<body>

<img class="icon" src="images/icon11.gif" alt="">

<h1>11. The format of the header</h1>

<h2>11.1</h2>
<p>The header table summarises locations in the Z-machine's
   header.
   "Hex" means the address, in hexadecimal;
   "Len" means the length in bytes;
   "V" the earliest Version to which the rule is applicable;
   "Dyn" means that the byte or bit may legally be changed by the game
   during play; 
   "Int" means that the interpreter may change it; 
   "Rst" means that the interpreter must set it correctly after loading the game,
   after a restore or after a restart;
   "Con" means that the field is meaningful only by convention (since existing Infocom and Inform games write them), and the interpreter need not know about their contents.
</p>

<table>
  <caption><strong>Header format</strong></caption>
  <tr><th> Hex</th><th>Len</th><th>V          </th><th>Dyn</th><th>Int</th><th>Rst</th><th>Con</th><th>Contents</th></tr>
  <tr><td>  0 </td><td> 1 </td><td> 1         </td><td>   </td><td>   </td><td>   </td><td>   </td><td>Version number (1 to 8)</td></tr>
  <tr><td>  1 </td><td> 1 </td><td> 3         </td><td>   </td><td>   </td><td>   </td><td>   </td><td><em>Flags 1 (see <a href="sect11.html#11.1.4"><strong>ยง</strong> 11.1.4</a>)</em></td></tr>
  <tr><td>  2 </td><td> 2 </td><td> 1         </td><td>   </td><td>   </td><td>   </td><td> * </td><td> Release number (word)</td></tr>
  <tr><td>  4 </td><td> 2 </td><td> 1         </td><td>   </td><td>   </td><td>   </td><td>   </td><td>Base of high memory (byte address)</td></tr>
  <tr><td>  6 </td><td> 2 </td><td> 1         </td><td>   </td><td>   </td><td>   </td><td>   </td><td>Initial value of program counter (byte address)</td></tr>
  <tr><td>    </td><td> 2 </td><td> 6         </td><td>   </td><td>   </td><td>   </td><td>   </td><td>Packed address of initial "main" routine</td></tr>
  <tr><td>  8 </td><td> 2 </td><td> 1         </td><td>   </td><td>   </td><td>   </td><td>   </td><td>Location of dictionary (byte address)</td></tr>
  <tr><td>  A </td><td> 2 </td><td> 1         </td><td>   </td><td>   </td><td>   </td><td>   </td><td>Location of object table (byte address)</td></tr>
  <tr><td>  C </td><td> 2 </td><td> 1         </td><td>   </td><td>   </td><td>   </td><td>   </td><td>Location of global variables table (byte address)</td></tr>
  <tr><td>  E </td><td> 2 </td><td> 1         </td><td>   </td><td>   </td><td>   </td><td>   </td><td>Base of static memory (byte address)</td></tr>
  <tr><td> 10 </td><td> 2 </td><td> 1         </td><td>   </td><td>   </td><td>   </td><td>   </td><td>Flags 2 (see <a href="sect11.html#11.1.2"><strong>ยง</strong> 11.1.2</a>)</td></tr>

  <tr><td> 12 </td><td> 6 </td><td> 2         </td><td>   </td><td>   </td><td>   </td><td> * </td><td> Serial code (six characters of ASCII)</td></tr>
  <tr><td>    </td><td>   </td><td> 3         </td><td>   </td><td>   </td><td>   </td><td> * </td><td> Serial number (ASCII for the compilation date in the form YYMMDD)</td></tr>
  <tr><td>    </td><td>   </td><td>           </td><td>   </td><td>   </td><td>   </td><td>   </td><td> (For bits 3,4,5,7 and 8, Int clears again if it cannot provide the requested effect.)</td></tr>
  <tr><td> 18 </td><td> 2 </td><td> 2         </td><td>   </td><td>   </td><td>   </td><td>   </td><td>Location of abbreviations table (byte address)</td></tr>
  <tr><td> 1A </td><td> 2 </td><td> 3+        </td><td>   </td><td>   </td><td>   </td><td>   </td><td>Length of file (see note)</td></tr>
  <tr><td> 1C </td><td> 2 </td><td> 3+        </td><td>   </td><td>   </td><td>   </td><td>   </td><td>Checksum of file</td></tr>
  <tr><td> 1E </td><td> 1 </td><td> 4         </td><td>   </td><td> * </td><td> * </td><td>   </td><td>Interpreter number</td></tr>
  <tr><td> 1F </td><td> 1 </td><td> 4         </td><td>   </td><td> * </td><td> * </td><td>   </td><td>Interpreter version</td></tr>
  <tr><td> 20 </td><td> 1 </td><td> 4         </td><td>   </td><td> * </td><td> * </td><td>   </td><td>Screen height (lines)</td></tr>
  <tr><td> 21 </td><td> 1 </td><td> 4         </td><td>   </td><td> * </td><td> * </td><td>   </td><td>Screen width (characters)</td></tr>
  <tr><td> 22 </td><td> 2 </td><td> 5         </td><td>   </td><td> * </td><td> * </td><td>   </td><td>Screen width in units</td></tr>
  <tr><td> 24 </td><td> 2 </td><td> 5         </td><td>   </td><td> * </td><td> * </td><td>   </td><td>Screen height in units</td></tr>
  <tr><td> 26 </td><td> 1 </td><td> 5         </td><td>   </td><td> * </td><td> * </td><td>   </td><td>Font width in units (defined as width of a '0')</td></tr>
  <tr><td>    </td><td>   </td><td> 6         </td><td>   </td><td> * </td><td> * </td><td>   </td><td>Font height in units</td></tr>
  <tr><td> 27 </td><td> 1 </td><td> 5         </td><td>   </td><td> * </td><td> * </td><td>   </td><td>Font height in units</td></tr>
  <tr><td>    </td><td>   </td><td> 6         </td><td>   </td><td> * </td><td> * </td><td>   </td><td>Font width in units (defined as width of a '0')</td></tr>
  <tr><td> 28 </td><td> 2 </td><td> 6         </td><td>   </td><td>   </td><td>   </td><td>   </td><td>Routines offset (divided by 8)</td></tr>
  <tr><td> 2A </td><td> 2 </td><td> 6         </td><td>   </td><td>   </td><td>   </td><td>   </td><td>Static strings offset (divided by 8)</td></tr>
  <tr><td> 2C </td><td> 2 </td><td> 5         </td><td>   </td><td> * </td><td> * </td><td>   </td><td>Default background colour</td></tr>
  <tr><td> 2D </td><td> 2 </td><td> 5         </td><td>   </td><td> * </td><td> * </td><td>   </td><td>Default foreground colour</td></tr>
  <tr><td> 2E </td><td> 2 </td><td> 5         </td><td>   </td><td>   </td><td>   </td><td>   </td><td>Address of terminating characters table (bytes)</td></tr>
  <tr><td> 30 </td><td> 2 </td><td> 6         </td><td>   </td><td> * </td><td>   </td><td>   </td><td>Total width in pixels of text sent to output stream 3</td></tr>
  <tr><td> 32 </td><td> 2 </td><td> 1         </td><td>   </td><td> * </td><td> * </td><td>   </td><td>Standard revision number</td></tr>
  <tr><td> 34 </td><td> 2 </td><td> 5         </td><td>   </td><td>   </td><td>   </td><td>   </td><td>Alphabet table address (bytes), or 0 for default</td></tr>
  <tr><td> 36 </td><td> 2 </td><td> 5         </td><td>   </td><td>   </td><td>   </td><td>   </td><td>Header extension table address (bytes)</td></tr>
  <tr><td> 38 </td><td> 8 </td><td> 6         </td><td>   </td><td> * </td><td>   </td><td> * </td><td>Infocom used this as 8 bytes of ASCII: the player's user-name on their own mainframe, useful to identify which person played a saved-game (however, the bytes are all 0 in shipped story files)</td></tr>
  <tr><td> 3C </td><td> 4 </td><td>          </td><td>    </td><td>   </td><td>   </td><td> * </td><td>Inform 6 stores 4 bytes of ASCII here, giving the version of Inform used to compile the file: for instance, "6.11".</td></tr>






</table>

<p>Some early Version 3 files do not contain length and checksum
   data, hence the notation <strong>3+</strong>.
</p>



</table>

<h2 id="11.1.1">11.1.1</h2>
<p>It is illegal for a game to alter those
   fields not marked as "Dyn".  An interpreter is therefore free to
   store values of such fields in its own variables.
</p>

<h2 id="11.1.2"> 11.1.2</h2>
<p>Flags 2:</p>
<table>
  <tr><th>Bit</th><th>V          </th><th>Dyn</th><th>Int</th><th>Rst</th><th>Con</th><th>Contents</th></tr>
  <tr><td>  0</td><td><em>1</em> </td><td> * </td><td> * </td><td> * </td><td>   </td><td>Set when transcripting is on</td></tr>
  <tr><td>  1</td><td><em>3</em> </td><td> * </td><td>   </td><td> * </td><td>   </td><td>Game sets to force printing in fixed-pitch font</td></tr>
  <tr><td>  2</td><td><em>6</em> </td><td> * </td><td> * </td><td>   </td><td>   </td><td>Int sets to request screen redraw: game clears when it complies with this.</td></tr>
  <tr><td>  3</td><td><em>5</em> </td><td>   </td><td> * </td><td> * </td><td>   </td><td>If set, game wants to use pictures</td></tr>
  <tr><td>  4</td><td><em>3</em> </td><td>   </td><td>   </td><td>   </td><td> * </td><td>Set in the Amiga version of The Lurking Horror so presumably to do with sound effects?</td></tr>
  <tr><td>   </td><td><em>5</em> </td><td>   </td><td> * </td><td> * </td><td>   </td><td>If set, game wants to use the UNDO opcodes</td></tr>
  <tr><td>  5</td><td><em>5</em> </td><td>   </td><td> * </td><td> * </td><td>   </td><td>If set, game wants to use a mouse</td></tr>
  <tr><td>  6</td><td><em>5</em> </td><td>   </td><td>   </td><td>   </td><td>   </td><td>If set, game wants to use colours</td></tr>
  <tr><td>  7</td><td><em>5</em> </td><td>   </td><td> * </td><td> * </td><td>   </td><td>If set, game wants to use sound effects</td></tr>
  <tr><td>  8</td><td><em>6</em> </td><td>   </td><td> * </td><td> * </td><td>   </td><td>If set, game wants to use menus</td></tr>
  <tr><td> 10</td><td> ?         </td><td> ? </td><td> * </td><td>   </td><td> * </td><td>Possibly set by interpreter to indicate an error with the printer during transcription</td></tr>
 </table>
<p>Those fields marked as "Con" are of uncertain function, and interpreters are not required to pay attention to them.</p>
<p>"Bit 0" refers to bit 0 of the second byte, "Bit 8" refers to bit 0 of the first byte.</p>

<h2 id="11.1.2.1"> 11.1.2.1</h2>
<p>The state of the transcription bit (bit 0 of Flags 2) can
   be changed directly by the game to turn transcribing on or off
   (see <strong>S</strong> 7.3, <strong>S</strong> 7.4).  The interpreter must also alter it if
   stream 2 is turned on or off, to ensure that the bit always
   reflects the true state of transcribing.  Note that the
   interpreter ensures that its value survives a restart or restore.
</p>

<h2>11.1.3</h2>
<p>Infocom used the interpreter numbers:</p>

<pre>
   1   DECSystem-20     5   Atari ST           9   Apple IIc
   2   Apple IIe        6   IBM PC            10   Apple IIgs
   3   Macintosh        7   Commodore 128     11   Tandy Color
   4   Amiga            8   Commodore 64
</pre>

<p>(The DECSystem-20 was Infocom's own in-house mainframe.)  An interpreter
   should choose the interpreter number most suitable for the machine it
   will run on.  In Versions up to 5, the main consideration is that the
   behaviour of 'Beyond Zork' depends on the interpreter number (in terms
   of its usage of the character graphics font).  In Version 6, the
   decision is more serious, as existing Infocom story files depend
   on interpreter number in many ways: moreover, some story files
   expect to be run only on the interpreters for a particular machine.
   (There are, for instance, specifically Amiga versions.)
</p>

<h2>11.1.3.1</h2>
<p>Interpreter versions are conventionally ASCII codes for
   upper-case letters in Versions 4 and 5 (note that Infocom's Version 6
   interpreters just store numbers here).
</p>

<p>Modern games are strongly discouraged from testing the interpreter number or interpreter version
   header information for any game-changing behaviour. It is rarely meaningful, and a Standard interpreter
   provides many better ways to query the interpreter for information.
</p>

<h2>11.1.4</h2>
<p>Flags 1:</p>
<table>
<caption><strong>Versions 1 to 3</strong></caption>
  <tr><th>Bit</th><th> V </th><th>Dyn</th><th>Int</th><th>Rst</th><th>Con</th><th>Contents</th></tr>
  <tr><td> 1 </td><td> 1 </td><td>   </td><td>   </td><td>   </td><td>   </td><td>Status line type: 0=score/turns, 1=hours:mins</td></tr>
  <tr><td> 2 </td><td> 1 </td><td>   </td><td>   </td><td>   </td><td>   </td><td>Story file split across two discs?</td></tr>
  <tr><td> 3 </td><td> 3 </td><td>   </td><td> * </td><td>   </td><td> * </td><td>The legendary "Tandy" bit (see <a href="sect11.html#remarks">Remarks</a>)</td></tr>
  <tr><td> 4 </td><td> 1 </td><td>   </td><td> * </td><td> * </td><td>   </td><td>Status line not available?</td></tr>
  <tr><td> 5 </td><td> 3 </td><td>   </td><td> * </td><td> * </td><td>   </td><td>Screen-splitting available?</td></tr>
  <tr><td> 6 </td><td> ? </td><td>   </td><td> * </td><td> * </td><td>   </td><td>Is a variable-pitch font the default?</td></tr>
</table>

<table>
<caption><strong>from Version 4</strong></caption>
  <tr><th>Bit</th><th> V </th><th>Dyn</th><th>Int</th><th>Rst</th><th>Con</th><th>Contents</th></tr>
  <tr><td> 0 </td><td> 5</em> </td><td>   </td><td> * </td><td> * </td><td>   </td><td>Colours available?</td></tr>
  <tr><td> 1 </td><td> 4</em> </td><td>   </td><td> * </td><td> * </td><td>   </td><td>Status line type (see <a href="sect11.html#remarks">Remarks</a>)</td></tr>
  <tr><td>   </td><td> 6</em> </td><td>   </td><td> * </td><td> * </td><td>   </td><td>Picture displaying available?</td></tr>
  <tr><td> 2 </td><td> 4</em> </td><td>   </td><td> * </td><td> * </td><td>   </td><td>Boldface available?</td></tr>
  <tr><td> 3 </td><td> 4</em> </td><td>   </td><td> * </td><td> * </td><td>   </td><td>Italic available?</td></tr>
  <tr><td> 4 </td><td> 4</em> </td><td>   </td><td> * </td><td> * </td><td>   </td><td>Fixed-space style available?</td></tr>
  <tr><td> 5 </td><td> 6</em> </td><td>   </td><td> * </td><td> * </td><td>   </td><td>Sound effects available?</td></tr>
  <tr><td> 7 </td><td> 4</em> </td><td>   </td><td> * </td><td> * </td><td>   </td><td>Timed keyboard input available?</td></tr>
</table>
<p>Those fields marked as "Con" are meaningful only by convention (since existing Infocom and Inform games write them), and the interpreter need not know about their state.</p>

<h2>11.1.4.1</h2>
<p><strong>***[1.0]</strong>
   The use of bit 7 in 'Flags 1' to signal whether timed
   input is available was new in the 1.0 document: see the preface.
</p>

<h2>11.1.5</h2>
<p><strong>***[1.0]</strong>
   If an interpreter obeys Revision <strong>n.m</strong> of this document
   <em>perfectly</em>, as far as anyone knows,
   then byte <strong>$32</strong> should be written with
   <strong>n</strong> and byte <strong>$33</strong> with <strong>m</strong>.
   If it is an earlier (non-standard)
   interpreter, it should leave these bytes as 0.
</p>

<h2>11.1.6</h2>
<p>The file length stored at <strong>$1a</strong> is actually divided by a constant,
   depending on the Version, to make it fit into a header word.  This constant
   is 2 for Versions 1 to 3, 4 for Versions 4 to 5 or 8 for Versions 6 and
   later.
</p>

<h2>11.1.7</h2>
<p>The header extension table provides potentially unlimited
   room for further header information.  It is a table of word entries,
   in which the initial word contains the number of words of data to follow.
</p>

<h2>11.1.7.1</h2>
<p>If the interpreter needs to read a word which is beyond the
   length of the extension table, or the extension table doesn't exist at
   all, then the result is 0.
</p>

<h2>11.1.7.2</h2>
<p>If the interpreter needs to write a word which is beyond the
   length of the extension table, or the extension table doesn't exist at
   all, then the result is that nothing happens.
</p>

<h2>11.1.7.3</h2>
<p><strong>***[1.0][1.1]</strong>
   Words in the header extension table have been allocated
   as follows:
</p>

<table>
  <caption><strong>Header extension format</strong></caption>

  <tr><td><strong>Word  </strong></td><td><strong>V  </strong></td><td><strong>Dyn </strong></td><td><strong>Int </strong></td>
      <td><strong>Rst  </strong></td><td><strong>Contents</strong></td>
  </tr>

  <tr><td>  0   </td><td>5  </td><td>    </td><td>    </td><td>     </td><td>Number of further words in table</td></tr>
  <tr><td>  1   </td><td>5  </td><td>    </td><td> *  </td><td>     </td><td>X-coordinate of mouse after a click</td></tr>
  <tr><td>  2   </td><td>5  </td><td>    </td><td> *  </td><td>     </td><td>Y-coordinate of mouse after a click</td></tr>
  <tr><td>  3   </td><td>5  </td><td>    </td><td>    </td><td>     </td><td>Unicode translation table address (optional)</td></tr>
  <tr><td>  4   </td><td>5  </td><td>    </td><td>    </td><td>     </td><td><em>Flags 3:</em></td></tr>

  <tr><td>      </td><td><em>6</em></td><td>    </td><td> *  </td><td> *   </td>
      <td>0: If set, game wants to use transparency</td>
  </tr>

  <tr><td>  5   </td><td>5  </td><td>    </td><td> *  </td><td> *   </td>
      <td>True default foreground colour</td>
  </tr>

  <tr><td>  6   </td><td>5  </td><td>    </td><td> *  </td><td> *   </td>
      <td>True default background colour</td>
  </tr>

</table>

<h2>11.1.7.4</h2>
<p><strong>***[1.1]</strong>
   The bits in Flags 3 are set by the game to request use of a feature. If the interpreter cannot
   provide a feature, it must clear the relevant bit.
</p>

<h2>11.1.7.4.1</h2>
<p><strong>***[1.1]</strong>
   All unused bits in Flags 3 must be cleared by the interpreter.</p>


<hr>

<h2>Remarks</h2>
<p>Some early Infocom games were sold by the Tandy Corporation, who
   seem to have been sensitive souls.  'Zork I' pretends not to have sequels
   if it finds the Tandy bit set.  And to quote Paul David Doherty:
   <blockquote>
    In 'The Witness', the Tandy Flag can be set while playing the game,
    by typing <strong>$DB</strong> and then <strong>$TA</strong>.
    If it is set, some of the prose will be
    less offensive. For example, "private dicks" become "private eyes",
    "bastards" are only "idiots", and all references to "slanteyes" and
    "necrophilia" are removed.
   </blockquote>
   We live in an age of censorship.
</p>

<p>Inform v4+ games (except v6) carry the meaning of bit 1 of Flags 1 over from
   the v3 games, using it to decide between 'time' and 'score' type status lines.
   This is part of the standard Inform 6 library, and interpreters should ignore this
   bit in versions 4 and later, except version 6.
</p>

<p>In the Infocom period, the larger Version 3 story files would
   not entirely fit on a single Atari 800 disc (though they would fit
   on a single Apple II, or a single PC disc).  Atari versions were
   therefore made which were identical to the normal ones except for
   having Flags 1 bit 2 set, and were divided into the resident part
   on one disc and the rest on another.  (This discovery was announced
   by Stefan Jokisch on 26 August 1997 and sees the end of one of the
   very few Z-machine mysteries left when Standard 1.0 was first published.)
</p>

<p>See the "Infocom fact sheet" for numbers and letters of the known
   interpreters shipped by Infocom.  Interpreter versions are conventionally
   the upper case letters in sequence (A, B, C, ...).  At present most ports
   of <strong>Zip</strong> use interpreter number 6, and most of <strong>ITF</strong> use number 2.
</p>

<p>The unusual behaviour of 'Beyond Zork' concerns its character graphics:
   see the remarks to <strong>S</strong> 16.
</p>

<p>The Macintosh story file for 'Zork Zero' erroneously does not set
   the pictures bit (Flags 2, bit 3).
</p>

<p>The bit in the header described as "requesting screen redraw" may be set by
   modern interpreters after, for example, resizing the "screen"; games should
   ideally redraw the screen if they see this bit set. This will usually mean
   the game clears the screen contents and rearranges borders, etc, so the bit
   should not be set except when necessary.
</p>

<p>The (Version 6) sound and picture bits in Flags 1 indicate general
   availability of sound and graphics - ie whether the associated opcodes are
   available and functional.
</p>

<p>The bits in Flags 2 should ideally be set reflecting current
   availability, rather than general support. In other words, if no Blorb (or
   other) resources for this story file have been found, or if the Blorb file
   contains no graphics or no sound, the corresponding bits should be cleared.
</p>

<p>Also, it is recommended that interpreters that would prompt for an auxiliary
   Blorb file should do so immediately on start up if any of the "game wants to
   use sound/music/graphics" bits are set; this allows the bits to be cleared if
   no file is forthcoming, before the game starts execution. The game can then
   take appropriate action.
</p>

<p>In Versions 1 to 3, bits 0 and 7 of 'Flags 1' are unused. In later Versions, 
   bits 0, 6 and 7 are unused.  In 'Flags 2', bits 9 and 11-15 are unused.  
   Infocom used up almost the whole header: only the bytes at <strong>$32</strong>
   and <strong>$33</strong> are unused in any Version, and those are now allocated for
   standard interpreters to give their Revision numbers.
</p>

<p>For comment on interpreter numbers,
   see <strong>ยง</strong> 11. Infocom's own interpreters
   were generally rewritten for each of versions 3 to 6.  For instance,
   interpreters known to have been shipped with the Macintosh gave version
   letters B, C, G, I (Version 3), E, H, I (Version 4), A, B, C (Version 5) and
   finally 6.1 for Version 6.  (Version 6 interpreters seem to have version
   numbers rather than letters.)  See the "Infocom fact sheet" for fuller
      details.
</p>

<p>Inform 6 story files are easily distinguished from all other story files
   by their usage of the last four header bytes.  Inform 1 to 5 story files
   are best distinguished from Infocom ones by the serial code date: anything
   before 930000 is either an Infocom file, or a fake.
   The decision of how to continue serial codes past the year 2079 is deferred 
   to a future revision of this Standard.
   Clearly there is no point going to any trouble to prevent fakes, but with
   a little practice it's easy to tell whether Zilch or Inform compiled a
   file from the style of code generated.
</p>

<hr>

<p>
  <a href="index.html">Contents</a> / 
  <a href="preface.html">Preface</a> /
  <a href="overview.html">Overview</a>
</p>

<p>Section
  <a href="sect01.html">1</a> / <a href="sect02.html">2</a> /
  <a href="sect03.html">3</a> / <a href="sect04.html">4</a> /
  <a href="sect05.html">5</a> / <a href="sect06.html">6</a> /
  <a href="sect07.html">7</a> / <a href="sect08.html">8</a> /
  <a href="sect09.html">9</a> / <a href="sect10.html">10</a> /
  <a href="sect11.html">11</a> / <a href="sect12.html">12</a> /
  <a href="sect13.html">13</a> / <a href="sect14.html">14</a> /
  <a href="sect15.html">15</a> / <a href="sect16.html">16</a>
</p>

<p>Appendix
  <a href="appa.html">A</a> / <a href="appb.html">B</a> /
  <a href="appc.html">C</a> / <a href="appd.html">D</a> /
  <a href="appe.html">E</a> / <a href="appf.html">F</a>
</p>

<hr>

</body>
</html>
